---
apiVersion: v1
kind: ConfigMap
metadata:
  name: job-agent-config
  namespace: default
  labels:
    app: job-agent

data:
  # Application settings
  ENVIRONMENT: "production"
  DEBUG: "false"
  LOG_LEVEL: "INFO"
  
  # API settings
  API_HOST: "0.0.0.0"
  API_PORT: "7860"
  API_WORKERS: "4"
  API_TIMEOUT: "60"
  
  # Model settings
  VOCAB_SIZE: "5000"
  MODEL_HIDDEN_DIM: "256"
  MODEL_NUM_HEADS: "8"
  MODEL_NUM_LAYERS: "4"
  MODEL_MAX_SEQ_LEN: "512"
  
  # Training settings
  BATCH_SIZE: "32"
  LEARNING_RATE: "0.0001"
  EPOCHS: "10"
  
  # Device settings
  USE_GPU: "true"
  CUDA_VISIBLE_DEVICES: "0"
  
  # Database settings
  DATABASE_POOL_SIZE: "20"
  DATABASE_MAX_OVERFLOW: "40"
  DATABASE_POOL_RECYCLE: "3600"
  DATABASE_ECHO: "false"
  
  # Cache settings
  CACHE_ENABLED: "true"
  CACHE_TYPE: "redis"
  CACHE_TTL: "3600"
  CACHE_MAX_SIZE: "1000"
  
  # Logging settings
  LOG_FORMAT: "json"
  LOG_FILE_PATH: "/app/logs/app.log"
  LOG_MAX_SIZE: "10485760"  # 10MB
  LOG_BACKUP_COUNT: "10"
  
  # Feature flags
  FEATURE_SCRAPER_ENABLED: "true"
  FEATURE_CUSTOMIZER_ENABLED: "true"
  FEATURE_CLASSIFIER_ENABLED: "true"
  FEATURE_BATCH_PROCESSING: "true"
  FEATURE_COVER_LETTER_GENERATION: "true"
  
  # Scraper settings
  SCRAPER_TIMEOUT: "10"
  SCRAPER_MAX_JOBS: "50"
  SCRAPER_DEFAULT_LOCATION: "Remote"
  
  # Classifier settings
  CLASSIFIER_MIN_SCORE: "0.5"
  CLASSIFIER_BATCH_SIZE: "16"
  
  # Server settings
  SERVER_HOST: "0.0.0.0"
  SERVER_PORT: "7860"
  SERVER_WORKERS: "4"
  SERVER_RELOAD: "false"
  
  # Monitoring settings
  PROMETHEUS_ENABLED: "true"
  PROMETHEUS_PORT: "8000"
  PROMETHEUS_METRICS_PREFIX: "job_agent_"
  
  # Health check settings
  HEALTH_CHECK_INTERVAL: "30"
  HEALTH_CHECK_TIMEOUT: "10"
  
  # Configuration files (optional, can reference separate ConfigMaps)
  config.yaml: |
    app:
      name: "Job Application Agent"
      version: "1.0.0"
      environment: "production"
      debug: false
      
    model:
      vocab_size: 5000
      hidden_dim: 256
      num_heads: 8
      num_layers: 4
      max_seq_length: 512
      dropout_rate: 0.1
      
    training:
      learning_rate: 0.0001
      batch_size: 32
      epochs: 10
      weight_decay: 0.01
      gradient_clip: 1.0
      
    scraper:
      platforms:
        - linkedin
        - indeed
        - glassdoor
      max_jobs: 50
      timeout: 10
      
    cache:
      enabled: true
      type: redis
      ttl: 3600
      
    logging:
      level: INFO
      format: json
      file_path: /app/logs/app.log
      max_size: 10485760
      backup_count: 10

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: job-agent-nginx-config
  namespace: default
  labels:
    app: job-agent

data:
  nginx.conf: |
    user nginx;
    worker_processes auto;
    error_log /var/log/nginx/error.log warn;
    pid /var/run/nginx.pid;

    events {
      worker_connections 1024;
    }

    http {
      include /etc/nginx/mime.types;
      default_type application/octet-stream;

      log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

      access_log /var/log/nginx/access.log main;

      sendfile on;
      tcp_nopush on;
      tcp_nodelay on;
      keepalive_timeout 65;
      types_hash_max_size 2048;
      client_max_body_size 100M;

      gzip on;
      gzip_vary on;
      gzip_min_length 1024;
      gzip_types text/plain text/css text/xml text/javascript
                 application/x-javascript application/xml+rss
                 application/json;

      upstream job_agent {
        least_conn;
        server job-agent:7860 max_fails=3 fail_timeout=30s;
        server job-agent:7860 backup;
      }

      server {
        listen 80;
        server_name _;

        location / {
          proxy_pass http://job_agent;
          proxy_set_header Host $host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_set_header X-Forwarded-Proto $scheme;
          proxy_connect_timeout 60s;
          proxy_send_timeout 60s;
          proxy_read_timeout 60s;
        }

        location /health {
          proxy_pass http://job_agent;
          access_log off;
        }

        location /metrics {
          proxy_pass http://job_agent:8000;
          access_log off;
        }
      }
    }

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: job-agent-logging-config
  namespace: default
  labels:
    app: job-agent

data:
  logging.yaml: |
    version: 1
    disable_existing_loggers: false
    
    formatters:
      standard:
        format: '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
      detailed:
        format: '%(asctime)s | %(name)s | %(funcName)s:%(lineno)d | %(levelname)s | %(message)s'
      json:
        class: pythonjsonlogger.jsonlogger.JsonFormatter
        format: '%(timestamp)s %(level)s %(name)s %(message)s'
    
    handlers:
      console:
        class: logging.StreamHandler
        level: INFO
        formatter: standard
        stream: ext://sys.stdout
      
      file:
        class: logging.handlers.RotatingFileHandler
        level: INFO
        formatter: detailed
        filename: /app/logs/app.log
        maxBytes: 10485760
        backupCount: 10
      
      error_file:
        class: logging.handlers.RotatingFileHandler
        level: ERROR
        formatter: detailed
        filename: /app/logs/error.log
        maxBytes: 10485760
        backupCount: 10
    
    loggers:
      '':
        level: INFO
        handlers: [console, file]
      
      src.scraper:
        level: DEBUG
        handlers: [console, file]
      
      src.classifier:
        level: DEBUG
        handlers: [console, file]
      
      src.customizer:
        level: DEBUG
        handlers: [console, file]
    
    root:
      level: INFO
      handlers: [console, file, error_file]
